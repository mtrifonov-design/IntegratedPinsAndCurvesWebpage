var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});(function(){"use strict";function e(e2,n2,t2){return e2+(n2-e2)*t2}__name(e,"e");function n(e2){return e2*e2*e2}__name(n,"n");function t(e2){return 1-Math.pow(1-e2,3)}__name(t,"t");function r(e2){return e2<.5?4*e2*e2*e2:1-Math.pow(-2*e2+2,3)/2}__name(r,"r");function a(e2){var n2=2*Math.PI/3;return e2===0?0:e2===1?1:Math.pow(2,-10*e2)*Math.sin((10*e2-.75)*n2)+1}__name(a,"a");var i={};function u(e2,n2){e2 in i||(i[e2]=n2)}__name(u,"u");function o(e2){return e2 in i?i[e2]:null}__name(o,"o");function s(i2){var s2=i2.nextPinTime,l2=i2.project,c2=i2.range,f2=i2.defaultValue,m2=i2.pinId,v2=i2.frame,p2=i2.numberOfFrames,d=i2.framesPerSecond,x=i2.nextPinValue,g=i2.previousPinTime,y=i2.previousPinValue,P=i2.relativeTime,I=i2.interpolateSignalValueAtTime,h=c2[0],V=c2[1];return{nextPinTime:s2,nextPinValue:x,project:l2,previousPinTime:g,defaultValue:f2,previousPinValue:y,relativeTime:P,frame:v2,pinId:m2,numberOfFrames:p2,framesPerSecond:d,maxValue:V,minValue:h,linearInterpolation:e,easeInCubic:n,easeOutCubic:t,easeInOutCubic:r,easeOutElastic:a,easyLinear:__name(function(){return P*(x-y)+y},"easyLinear"),bezier:__name(function(){var e2=l2.orgData.signalIdByPinId[i2.pinId],n2=l2.signalData[e2];if(n2&&"bezier"in n2){var t2=n2.bezierControlPoints[i2.pinId],r2=t2[0],a2=t2[1];r2+=s2,a2+=x;var u2=n2.pinIds.indexOf(i2.pinId)-1;u2=u2<0?0:u2;var o2=n2.pinIds[u2],c3=n2.bezierControlPoints[o2];c3[0],c3[1];var m3=c3[2],v3=c3[3];return function(e3,n3,t3,r3,a3){var i3=e3.y,u3=n3.y,o3=t3.y,s3=r3.y;return function(e4){return Math.pow(1-e4,3)*i3+3*Math.pow(1-e4,2)*e4*u3+3*(1-e4)*Math.pow(e4,2)*o3+Math.pow(e4,3)*s3}(a3)}({x:g,y},{x:m3+=g,y:v3+=y},{x:r2,y:a2},{x:s2,y:x},P)}return f2},"bezier"),easyStep:__name(function(){return x},"easyStep"),easyEaseIn:__name(function(){return y+n(P)*(x-y)},"easyEaseIn"),easyEaseOut:__name(function(){return y+t(P)*(x-y)},"easyEaseOut"),easyEase:__name(function(){return y+r(P)*(x-y)},"easyEase"),easyEaseOutElastic:__name(function(){return y+a(P)*(x-y)},"easyEaseOutElastic"),interpolateSignalValueAtTime:I,signal:__name(function(e2){return I(e2,v2)},"signal"),useAsset:o,saveAsset:u}}__name(s,"s");var l={},c={},f=1e-6,m=__name(function(e2,n2,t2,r2){var a2=e2.signalData[n2],i2=a2.range,u2=i2[0],o2=i2[1],m2=a2.defaultValue,v2=Object.entries(a2.pinTimes).sort(function(e3,n3){return e3[1]-n3[1]}),d=v2.find(function(e3){return e3[0],e3[1]>=t2});if(d===void 0)return[m2,[]];var x,g=d,y=g[0],P=g[1],I=a2.pinValues[y],h=a2.curves[y],V=u2,b=0,E=v2.findIndex(function(e3){var n3=e3[0];return e3[1],n3===y});if(E>0){var T=v2[E-1],w=T[0],O=T[1];V=a2.pinValues[w],b=O}else if(t2<P)return[m2,[]];var S=c[n2+y];if(S===void 0||S.functionString!==h){var F=`
            let nextPinTime = context.nextPinTime;
            let nextPinValue = context.nextPinValue;
            let previousPinTime = context.previousPinTime;
            let previousPinValue = context.previousPinValue;
            let relativeTime = context.relativeTime;
            let frame = context.frame;
            let numberOfFrames = context.numberOfFrames;
            let framesPerSecond = context.framesPerSecond;

            let interpolateSignalValue = context.interpolateSignalValue;
            let signal = context.signal;

            let bezier = context.bezier;

            let easyLinear = context.easyLinear;
            let easyEaseIn = context.easyEaseIn;
            let easyEaseOut = context.easyEaseOut;
            let easyStep = context.easyStep;
            let easyEase = context.easyEase;
            let easyEaseOutElastic = context.easyEaseOutElastic;


            `.concat(h);x=new Function("context","templates",F),c[n2+y]={functionString:h,cachedFunction:x}}else x=S.cachedFunction;var M=(t2-b)/(P!==b?P-b:1),D=m2,j=[];try{var z=s({nextPinTime:P,nextPinValue:I,previousPinTime:b,project:e2,previousPinValue:V,defaultValue:m2,relativeTime:M,pinId:y,frame:t2,range:[u2,o2],numberOfFrames:e2.timelineData.numberOfFrames,framesPerSecond:e2.timelineData.framesPerSecond,interpolateSignalValueAtTime:__name(function(n3,t3){var a3=e2.orgData.signalIds.find(function(t4){return e2.orgData.signalNames[t4]===n3});if(a3===void 0)throw new Error("Signal not found");var i3=p(e2,a3,t3,r2),u3=i3[0],o3=i3[1];if(typeof u3=="string")throw new Error("Interpolation function returned string");return j.push.apply(j,o3),u3},"interpolateSignalValueAtTime")}),A=function(e3){var n3={};return Object.entries(e3.templateData).forEach(function(e4){var t3=e4[0],r3=e4[1];if(l[t3]!==void 0){if(l[t3].functionString===r3){var a3=l[t3].cachedFunction;return void(n3[t3]=a3)}}else a3=new Function("return ".concat(r3,";"))(),n3[t3]=a3,l[t3]={functionString:r3,cachedFunction:a3}}),n3}(e2);D=x(z,A)}catch(e3){j.push({signalId:n2,frame:t2,error:e3.message})}if(isNaN(D)&&(D=m2,j.push({signalId:n2,frame:t2,error:"Interpolated value is NaN"})),D<u2&&(D=u2,Math.abs(D-u2)>f&&j.push({signalId:n2,frame:t2,error:"Interpolated value below minimum"})),D>o2){var C=D;D=o2,Math.abs(C-o2)>f&&j.push({signalId:n2,frame:t2,error:"Interpolated value above maximum: "+C})}return[D,j]},"m"),v=__name(function(e2,n2,t2,r2){var a2=e2.signalData[n2],i2=a2.defaultValue,u2=Object.entries(a2.pinTimes).sort(function(e3,n3){return e3[1]-n3[1]}).find(function(e3){return e3[0],e3[1]>=t2});if(u2===void 0)return i2;var o2=u2[0];return u2[1],a2.pinValues[o2]},"v"),p=__name(function(e2,n2,t2,r2){if(r2===void 0&&(r2=0),++r2>1e3)throw new Error("Exceeded maximum iteration count");var a2=e2.timelineData.numberOfFrames;if(t2<0||t2>a2)throw new Error("Time out of range");var i2=e2.signalData[n2].type;if(i2==="discrete")return[v(e2,n2,t2),[]];if(i2==="continuous")return m(e2,n2,t2,r2);throw new Error("Invalid signal type")},"p");self.onmessage=function(e2){var n2=e2.data,t2=n2.id,r2=n2.object,a2=r2.project,i2=r2.signalId,u2=r2.frameArray.map(function(e3){return p(a2,i2,e3)});self.postMessage({id:t2,result:u2})}})();
